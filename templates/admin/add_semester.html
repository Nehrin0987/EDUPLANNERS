{% extends 'base.html' %}

{% block title %}Add Semester & Classes - EDUPLANNER{% endblock %}

{% block content %}
<div class="page-container">
    <a href="{% url 'manage_semesters' %}" class="back-link">
        <i class="bi bi-arrow-left"></i>
        Back to Semesters & Classes
    </a>

    <h1>Add Semester & Classes</h1>

    {% if errors.general %}
    <div class="general-error">
        {{ errors.general }}
    </div>
    {% endif %}

    <form method="post">
        {% csrf_token %}

        <!-- Department -->
        <div class="form-group {% if errors.department %}has-error{% endif %}">
            <label>Department *</label>
            <select name="department_id" class="form-select" required>
                <option value="">Select Department</option>
                {% for dept in departments %}
                <option value="{{ dept.id }}"
                    {% if selected_dept == dept.id %}selected{% endif %}
                    {% if form_data.department_id|stringformat:"s" == dept.id|stringformat:"s" %}selected{% endif %}>
                    {{ dept.code }} - {{ dept.name }}
                </option>
                {% endfor %}
            </select>
            {% if errors.department %}
            <div class="form-error">{{ errors.department }}</div>
            {% endif %}
        </div>

        <!-- Semester Number -->
        <div class="form-group {% if errors.number %}has-error{% endif %}">
            <label>Semester *</label>
            <select name="number" class="form-select" required>
                <option value="">Select Semester</option>
                {% for i in "12345678" %}
                <option value="{{ i }}" {% if form_data.number == i %}selected{% endif %}>
                    Semester {{ i }}
                </option>
                {% endfor %}
            </select>
            {% if errors.number %}
            <div class="form-error">{{ errors.number }}</div>
            {% endif %}
        </div>

        <!-- Academic Year -->
        <div class="form-group {% if errors.academic_year %}has-error{% endif %}">
            <label>Academic Year *</label>
            <input type="text" name="academic_year"
                   value="{{ form_data.academic_year|default:'' }}"
                   class="form-input" required>
            {% if errors.academic_year %}
            <div class="form-error">{{ errors.academic_year }}</div>
            {% endif %}
        </div>

        <!-- Status -->
        <div class="form-group">
            <label>Status</label>
            <select name="is_active" class="form-select">
                <option value="1" {% if form_data.is_active == "1" or not form_data.is_active %}selected{% endif %}>
                    Active
                </option>
                <option value="0" {% if form_data.is_active == "0" %}selected{% endif %}>
                    Inactive
                </option>
            </select>
        </div>

        <hr>

        <!-- Classes -->
        <h3>Classes (Optional)</h3>

        <div id="classesContainer">
            {% for cls in classes_data %}
            <div class="class-row">
                <label>Class Name</label>
                <input type="text" name="class_name[]" value="{{ cls.name }}" class="form-input">

                <label>Section</label>
                <input type="text" name="class_section[]" value="{{ cls.section }}" class="form-input">

                <label>Status</label>
                <select name="class_status[]" class="form-select">
                    <option value="1" {% if cls.status == "1" or not cls.status %}selected{% endif %}>
                        Active
                    </option>
                    <option value="0" {% if cls.status == "0" %}selected{% endif %}>
                        Inactive
                    </option>
                </select>
            </div>
            {% endfor %}
        </div>

        <button type="submit" class="btn btn-primary mt-3">
            Save Semester & Classes
        </button>
    </form>
</div>
{% endblock %}
